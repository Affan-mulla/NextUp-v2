# Create Idea Form - Architecture & Flow Diagrams

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Browser)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Create Idea Form Component                    â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Title Input (3-200 chars)                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Real-time validation                             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Character counter                                â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Rich Text Editor (Lexical)                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Inline image support (base64)                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Paste or drag-drop images                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Memoized component                               â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Image Upload Section                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Drag-and-drop zone                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ File picker button                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Image preview grid                               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Remove/Clear buttons                             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Form State                                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ React Hook Form                                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Zod validation                                   â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Error aggregation                                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Progress tracking                                â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Submit Button                                      â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Loading state                                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Disabled while submitting                        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                   â”‚
â”‚                           â”‚ useCreateIdea Hook                â”‚
â”‚                           â”‚ â€¢ Validate inputs                 â”‚
â”‚                           â”‚ â€¢ Upload manual images            â”‚
â”‚                           â”‚ â€¢ Submit to API                   â”‚
â”‚                           â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP POST
                            â”‚ /api/ideas/create
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Backend (Server)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         API Route Handler                                 â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  1. Validate session (better-auth)                        â”‚  â”‚
â”‚  â”‚  2. Parse request body                                    â”‚  â”‚
â”‚  â”‚  3. Validate title (3-200 chars)                          â”‚  â”‚
â”‚  â”‚  4. Parse Lexical editor JSON                             â”‚  â”‚
â”‚  â”‚  5. Extract base64 images from content                    â”‚  â”‚
â”‚  â”‚     â””â”€> uploadBase64ImagesToSupabase()                    â”‚  â”‚
â”‚  â”‚  6. Replace base64 URLs with Supabase URLs                â”‚  â”‚
â”‚  â”‚  7. Create idea in database (Prisma)                      â”‚  â”‚
â”‚  â”‚  8. Return created idea + author info                     â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”˜  â”‚
â”‚           â”‚                                      â”‚              â”‚
â”‚           â–¼                                      â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Supabase SDK      â”‚           â”‚   Prisma ORM        â”‚      â”‚
â”‚  â”‚                     â”‚           â”‚                     â”‚      â”‚
â”‚  â”‚ Upload base64       â”‚           â”‚ Create idea in      â”‚      â”‚
â”‚  â”‚ images to bucket    â”‚           â”‚ Ideas table         â”‚      â”‚
â”‚  â”‚ "ideas"             â”‚           â”‚                     â”‚      â”‚
â”‚  â”‚                     â”‚           â”‚ Fields:             â”‚      â”‚
â”‚  â”‚ Path structure:     â”‚           â”‚ â€¢ title             â”‚      â”‚
â”‚  â”‚ {userId}/           â”‚           â”‚ â€¢ description (JSON)â”‚      â”‚
â”‚  â”‚   editor/           â”‚           â”‚ â€¢ uploadedImages[]  â”‚      â”‚
â”‚  â”‚   timestamp-id.jpg  â”‚           â”‚ â€¢ userId            â”‚      â”‚
â”‚  â”‚                     â”‚           â”‚ â€¢ createdAt         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                      â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                      â”‚
            â–¼                                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Supabase       â”‚                â”‚  PostgreSQL      â”‚
    â”‚  Storage        â”‚                â”‚  Database        â”‚
    â”‚                 â”‚                â”‚                  â”‚
    â”‚ Bucket: ideas   â”‚                â”‚ Table: Ideas     â”‚
    â”‚ â€¢ base64 images â”‚                â”‚ â€¢ row created    â”‚
    â”‚ â€¢ file objects  â”‚                â”‚ â€¢ URLs stored    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow - Complete Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Opens â”‚
â”‚  /idea page â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CreateIdeaForm Component Renders        â”‚
â”‚  â€¢ Initializes with empty state          â”‚
â”‚  â€¢ Sets up form with React Hook Form     â”‚
â”‚  â€¢ Mounts all child components           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Interaction                        â”‚
â”‚  â€¢ Types title                           â”‚
â”‚  â€¢ Edits description in Lexical          â”‚
â”‚  â€¢ Selects or drags images               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Clicks Submit                      â”‚
â”‚  â€¢ Triggers form validation              â”‚
â”‚  â€¢ Zod schema validates inputs           â”‚
â”‚  â€¢ Updates loading state                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ NO  â”€â”€> Show validation errors â”€â”€â”
       â”‚                                   â”‚
       â”‚ YES                               â”‚
       â–¼                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  useCreateIdea Hook Executes             â”‚â”‚
â”‚                                          â”‚â”‚
â”‚  Step 1: Client-side Image Upload        â”‚â”‚
â”‚  â”œâ”€ Get authenticated session            â”‚â”‚
â”‚  â”œâ”€ Check uploadedImages array           â”‚â”‚
â”‚  â”œâ”€ Loop through each file               â”‚â”‚
â”‚  â”‚  â”œâ”€ Validate file (type, size)        â”‚â”‚
â”‚  â”‚  â”œâ”€ Upload to Supabase                â”‚â”‚
â”‚  â”‚  â”‚  â””â”€ Path: ideas/{userId}/uploads/ â”‚â”‚
â”‚  â”‚  â””â”€ Collect public URLs               â”‚â”‚
â”‚  â””â”€ Return array of uploaded URLs        â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 2: API Request                     â”‚â”‚
â”‚  â”œâ”€ POST /api/ideas/create               â”‚â”‚
â”‚  â”œâ”€ Headers: Content-Type: application/jsonâ”‚â”‚
â”‚  â”œâ”€ Body:                                â”‚â”‚
â”‚  â”‚  â”œâ”€ title: string                     â”‚â”‚
â”‚  â”‚  â”œâ”€ description: JSON string          â”‚â”‚
â”‚  â”‚  â””â”€ uploadedImageUrls: string[]       â”‚â”‚
â”‚  â””â”€ Show loading toast                   â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼ (Server receives request)              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 3: Server-side Validation          â”‚â”‚
â”‚  â”œâ”€ Validate session (better-auth)       â”‚â”‚
â”‚  â”œâ”€ Extract userId from session          â”‚â”‚
â”‚  â”œâ”€ Validate title length (3-200)        â”‚â”‚
â”‚  â”œâ”€ Parse description JSON               â”‚â”‚
â”‚  â””â”€ Prepare for image processing         â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 4: Extract Base64 Images           â”‚â”‚
â”‚  â”œâ”€ Search description for base64        â”‚â”‚
â”‚  â”‚  â””â”€ Regex: data:image/...;base64,...  â”‚â”‚
â”‚  â”œâ”€ For each base64 image found:         â”‚â”‚
â”‚  â”‚  â”œâ”€ Convert to Blob                   â”‚â”‚
â”‚  â”‚  â”œâ”€ Generate unique filename          â”‚â”‚
â”‚  â”‚  â”œâ”€ Upload to Supabase                â”‚â”‚
â”‚  â”‚  â”‚  â””â”€ Path: ideas/{userId}/editor/   â”‚â”‚
â”‚  â”‚  â””â”€ Get public URL                    â”‚â”‚
â”‚  â””â”€ Create mapping: base64 â†’ URL         â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 5: Replace URLs in Description     â”‚â”‚
â”‚  â”œâ”€ Loop through mapping                 â”‚â”‚
â”‚  â”œâ”€ For each base64 URL:                 â”‚â”‚
â”‚  â”‚  â””â”€ Replace with Supabase URL         â”‚â”‚
â”‚  â”œâ”€ Update description JSON              â”‚â”‚
â”‚  â””â”€ Now contains only Supabase URLs      â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 6: Create Idea in Database         â”‚â”‚
â”‚  â”œâ”€ Call Prisma create                   â”‚â”‚
â”‚  â”œâ”€ Insert fields:                       â”‚â”‚
â”‚  â”‚  â”œâ”€ title: trimmed title             â”‚â”‚
â”‚  â”‚  â”œâ”€ description: updated JSON         â”‚â”‚
â”‚  â”‚  â”œâ”€ uploadedImages: URL array         â”‚â”‚
â”‚  â”‚  â”œâ”€ userId: from session              â”‚â”‚
â”‚  â”‚  â””â”€ createdAt: now()                  â”‚â”‚
â”‚  â”œâ”€ Include related author data          â”‚â”‚
â”‚  â””â”€ Return created idea object           â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â–¼ (Response sent back to client)         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  Step 7: Handle Response                 â”‚â”‚
â”‚  â”œâ”€ Update progress state                â”‚â”‚
â”‚  â”œâ”€ Show success toast                   â”‚â”‚
â”‚  â”‚  â””â”€ "Idea created successfully! ğŸ‰"   â”‚â”‚
â”‚  â”œâ”€ Reset form to initial state          â”‚â”‚
â”‚  â”œâ”€ Clear editor and uploads             â”‚â”‚
â”‚  â”œâ”€ Call onSuccess callback (if provided)â”‚â”‚
â”‚  â””â”€ Or redirect (if onSuccessRedirect)   â”‚â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
   â”‚                                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Hierarchy

```
CreateIdeaForm (Main Container)
â”œâ”€â”€ Card (UI Container)
â”‚   â”œâ”€â”€ CardHeader
â”‚   â”‚   â””â”€â”€ CardTitle "Create New Idea"
â”‚   â””â”€â”€ CardContent
â”‚       â”œâ”€â”€ Form Section 1: Title
â”‚       â”‚   â”œâ”€â”€ Label "Idea Title"
â”‚       â”‚   â”œâ”€â”€ Character Counter
â”‚       â”‚   â””â”€â”€ Controller (React Hook Form)
â”‚       â”‚       â””â”€â”€ Input (shadcn/ui)
â”‚       â”‚           â””â”€â”€ Real-time validation
â”‚       â”‚
â”‚       â”œâ”€â”€ Form Section 2: Description
â”‚       â”‚   â”œâ”€â”€ Label "Description"
â”‚       â”‚   â””â”€â”€ RichTextEditor (Memoized)
â”‚       â”‚       â””â”€â”€ Editor (Lexical)
â”‚       â”‚           â””â”€â”€ Plugin system
â”‚       â”‚
â”‚       â”œâ”€â”€ Form Section 3: Image Upload
â”‚       â”‚   â””â”€â”€ ImageUpload (Component)
â”‚       â”‚       â”œâ”€â”€ Drag-Drop Zone
â”‚       â”‚       â”‚   â””â”€â”€ File Input (hidden)
â”‚       â”‚       â””â”€â”€ Preview Grid
â”‚       â”‚           â”œâ”€â”€ Image Cards
â”‚       â”‚           â”‚   â”œâ”€â”€ Next Image
â”‚       â”‚           â”‚   â”œâ”€â”€ Remove Button
â”‚       â”‚           â”‚   â””â”€â”€ File Name Tooltip
â”‚       â”‚           â”œâ”€â”€ Clear All Button
â”‚       â”‚           â””â”€â”€ File Count Display
â”‚       â”‚
â”‚       â”œâ”€â”€ Progress Indicator (Conditional)
â”‚       â”‚   â”œâ”€â”€ Stage Label
â”‚       â”‚   â”œâ”€â”€ Progress Bar
â”‚       â”‚   â””â”€â”€ Step Counter
â”‚       â”‚
â”‚       â”œâ”€â”€ Error Summary (Conditional)
â”‚       â”‚   â””â”€â”€ Error List
â”‚       â”‚       â”œâ”€â”€ Title Error
â”‚       â”‚       â””â”€â”€ Description Error
â”‚       â”‚
â”‚       â””â”€â”€ Form Actions
â”‚           â”œâ”€â”€ Submit Button
â”‚           â”‚   â”œâ”€â”€ Loading Spinner (Conditional)
â”‚           â”‚   â””â”€â”€ Button Text
â”‚           â””â”€â”€ Reset Button
```

## State Management Flow

```
Component State (useState)
â”œâ”€â”€ editorState: SerializedEditorState
â”‚   â””â”€â”€ Lexical editor content (JSON)
â”‚
â””â”€â”€ uploadedImages: File[]
    â””â”€â”€ Manually selected images

Form State (React Hook Form)
â”œâ”€â”€ title: string
â”‚   â”œâ”€â”€ Default: ""
â”‚   â””â”€â”€ Validated: min 3, max 200
â”‚
â”œâ”€â”€ description: SerializedEditorState
â”‚   â””â”€â”€ Validated: non-empty
â”‚
â””â”€â”€ uploadedImages: File[]
    â””â”€â”€ Validated: type, size, count

Hook State (useCreateIdea)
â”œâ”€â”€ isLoading: boolean
â”‚   â””â”€â”€ True while submitting
â”‚
â”œâ”€â”€ isUploadingImages: boolean
â”‚   â””â”€â”€ True while uploading manual images
â”‚
â””â”€â”€ progress: object
    â”œâ”€â”€ current: number (0-3)
    â”œâ”€â”€ total: number (3)
    â””â”€â”€ stage: "idle" | "uploading-images" | "submitting" | "complete"
```

## Database Schema Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ideas Table                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (string, PK)                          â”‚
â”‚ title (string)                           â”‚
â”‚ description (JSON) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚ uploadedImages (string[]) â”€â”€â”€â”¼â”€â”€â”        â”‚
â”‚ userId (string, FK) â”€â”€â”€â”€â”€â”   â”‚  â”‚        â”‚
â”‚ votesCount (int)         â”‚   â”‚  â”‚        â”‚
â”‚ createdAt (DateTime)     â”‚   â”‚  â”‚        â”‚
â”‚ updatedAt (DateTime)     â”‚   â”‚  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚   â”‚  â”‚
                           â”‚   â”‚  â””â”€â†’ Supabase Storage URLs
                           â”‚   â”‚      ideas/{userId}/uploads/
                           â”‚   â”‚      ideas/{userId}/editor/
                           â”‚   â”‚
                           â”‚   â””â”€â†’ Lexical JSON with URLs
                           â”‚
                           â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  User Table          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ id (string, PK)      â”‚
      â”‚ name (string)        â”‚
      â”‚ email (string)       â”‚
      â”‚ image (string?)      â”‚
      â”‚ username (string)    â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Image Upload Paths

```
Supabase Storage Bucket: "ideas"
â”‚
â”œâ”€â”€ User A (uid: abc123)
â”‚   â”œâ”€â”€ uploads/
â”‚   â”‚   â”œâ”€â”€ 1730814525600-ghi789.jpg
â”‚   â”‚   â”œâ”€â”€ 1730814526700-jkl012.png
â”‚   â”‚   â””â”€â”€ 1730814527800-mno345.gif
â”‚   â”‚
â”‚   â””â”€â”€ editor/
â”‚       â”œâ”€â”€ 1730814523492-abc123.jpg
â”‚       â”œâ”€â”€ 1730814524501-def456.png
â”‚       â””â”€â”€ 1730814525505-uvw678.webp
â”‚
â””â”€â”€ User B (uid: xyz789)
    â”œâ”€â”€ uploads/
    â”‚   â””â”€â”€ 1730814528900-pqr678.jpg
    â”‚
    â””â”€â”€ editor/
        â””â”€â”€ 1730814530000-stu901.jpg

Public URLs:
https://xxx.supabase.co/storage/v1/object/public/ideas/{userId}/{type}/{filename}
```

## Error Handling Flow

```
User Action
    â”‚
    â”œâ”€ Client Validation Error
    â”‚  â””â”€ Display in error summary
    â”‚     â””â”€ User sees which fields invalid
    â”‚
    â”œâ”€ Client Image Upload Error
    â”‚  â”œâ”€ File type validation
    â”‚  â”œâ”€ File size validation
    â”‚  â”œâ”€ Too many files
    â”‚  â””â”€ Toast error notification
    â”‚
    â”œâ”€ Network/Supabase Error (client)
    â”‚  â””â”€ Toast error + error message
    â”‚     â””â”€ User can retry
    â”‚
    â”œâ”€ API Request Error
    â”‚  â”œâ”€ 401 Unauthorized
    â”‚  â”‚  â””â”€ "Please log in"
    â”‚  â”œâ”€ 400 Bad Request
    â”‚  â”‚  â””â”€ "Invalid input"
    â”‚  â””â”€ 500 Server Error
    â”‚     â””â”€ "Failed to create idea"
    â”‚
    â””â”€ Server Error (base64 upload)
       â””â”€ API catches and responds
          â””â”€ Toast error shown
```

## Performance Optimization Points

```
Rendering Optimization
â”œâ”€â”€ CreateIdeaForm
â”‚   â””â”€â”€ Memoized component
â”‚
â”œâ”€â”€ RichTextEditor
â”‚   â””â”€â”€ React.memo() wrapper
â”‚
â”œâ”€â”€ ImageUpload
â”‚   â””â”€â”€ useCallback for handlers
â”‚
â””â”€â”€ Form Handlers
    â””â”€â”€ useCallback dependencies

State Optimization
â”œâ”€â”€ Split state (component vs form vs hook)
â”‚   â””â”€â”€ Only necessary state in each
â”‚
â”œâ”€â”€ useCallback wrapping
â”‚   â””â”€â”€ Prevent re-render triggers
â”‚
â””â”€â”€ Memoization
    â””â”€â”€ Prevent child re-renders

Bundle Optimization
â”œâ”€â”€ Dynamic imports (if needed)
â”œâ”€â”€ Code splitting (editor)
â””â”€â”€ Tree-shaking for unused code
```

---

**Diagrams Version**: 1.0  
**Last Updated**: November 5, 2024
